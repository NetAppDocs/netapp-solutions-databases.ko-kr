---
sidebar: sidebar 
permalink: oracle/snapctr-ora-azure-anf.html 
keywords: Database, Oracle, Azure, ANF, Ansible, Automation 
summary: 이 솔루션은 NFS 프로토콜을 사용하여 기본 데이터베이스 저장소로 Microsoft Azure NetApp Files 에 자동화된 Oracle을 배포하기 위한 개요와 세부 정보를 제공하고, Oracle 데이터베이스는 dNFS가 활성화된 컨테이너 데이터베이스로 배포됩니다.  Azure에 배포된 데이터베이스는 SnapCenter UI 도구를 사용하여 보호되어 데이터베이스 관리가 간소화됩니다. 
---
= TR-4988: SnapCenter 사용한 ANF에서의 Oracle 데이터베이스 백업, 복구 및 복제
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


Allen Cao, Niyaz Mohamed, NetApp

[role="lead"]
이 솔루션은 NFS 프로토콜을 사용하여 기본 데이터베이스 저장소로 Microsoft Azure NetApp Files 에 자동화된 Oracle을 배포하기 위한 개요와 세부 정보를 제공하고, Oracle 데이터베이스는 dNFS가 활성화된 컨테이너 데이터베이스로 배포됩니다.  Azure에 배포된 데이터베이스는 SnapCenter UI 도구를 사용하여 보호되어 데이터베이스 관리가 간소화됩니다.



== 목적

NetApp SnapCenter software 애플리케이션, 데이터베이스, 파일 시스템 전반에서 데이터 보호를 안전하게 조정하고 관리할 수 있는 사용하기 쉬운 엔터프라이즈 플랫폼입니다.  스토리지 시스템의 활동을 감독하고 규제하는 기능을 희생하지 않고도 이러한 작업을 애플리케이션 소유자에게 위임하여 백업, 복원 및 복제 수명 주기 관리를 간소화합니다.  저장소 기반 데이터 관리를 활용하면 성능과 가용성이 향상되고 테스트 및 개발 시간이 단축됩니다.

TR-4987에서는link:../automation/automation-ora-anf-nfs.html["NFS를 사용한 Azure NetApp Files 에서의 간소화되고 자동화된 Oracle 배포"^] Azure 클라우드의 Azure NetApp Files (ANF)에서 자동화된 Oracle 배포를 시연합니다.  이 문서에서는 매우 사용자 친화적인 SnapCenter UI 도구를 사용하여 Azure 클라우드의 ANF에서 Oracle 데이터베이스를 보호하고 관리하는 방법을 소개합니다.

이 솔루션은 다음과 같은 사용 사례를 해결합니다.

* SnapCenter 사용하여 Azure 클라우드의 ANF에 배포된 Oracle 데이터베이스를 백업하고 복구합니다.
* 데이터베이스 스냅샷과 복제본을 관리하여 애플리케이션 개발을 가속화하고 데이터 수명 주기 관리를 개선합니다.




== 대상

이 솔루션은 다음과 같은 사람들을 위해 만들어졌습니다.

* Azure NetApp Files 에 Oracle 데이터베이스를 배포하려는 DBA입니다.
* Azure NetApp Files 에서 Oracle 워크로드를 테스트하려는 데이터베이스 솔루션 아키텍트입니다.
* Azure NetApp Files 에서 Oracle 데이터베이스를 배포하고 관리하려는 스토리지 관리자입니다.
* Azure NetApp Files 에 Oracle 데이터베이스를 구축하려는 애플리케이션 소유자입니다.




== 솔루션 테스트 및 검증 환경

이 솔루션의 테스트와 검증은 최종 배포 환경과 일치하지 않을 수 있는 실험실 환경에서 수행되었습니다.  섹션을 참조하세요<<배포 고려사항의 핵심 요소>> 자세한 내용은.



=== 아키텍처

image:automation-ora-anf-nfs-architecture.png["이 이미지는 iSCSI 및 ASM을 사용한 AWS 퍼블릭 클라우드의 Oracle 배포 구성에 대한 자세한 그림을 제공합니다."]



=== 하드웨어 및 소프트웨어 구성 요소

[cols="33%, 33%, 33%"]
|===


3+| *하드웨어* 


| Azure NetApp Files | Microsoft에서 Azure에 제공하는 현재 서비스 | 프리미엄 서비스 수준을 갖춘 용량 풀 


| DB 서버용 Azure VM | Standard_B4ms - 4개 vCPU, 16GiB | 두 개의 Linux 가상 머신 인스턴스 


| SnapCenter 용 Azure VM | Standard_B4ms - 4개 vCPU, 16GiB | 하나의 Windows 가상 머신 인스턴스 


3+| *소프트웨어* 


| 레드햇 리눅스 | RHEL Linux 8.6(LVM) - x64 Gen2 | 테스트를 위해 RedHat 구독을 배포했습니다. 


| 윈도우 서버 | 2022 데이터센터; AE 핫패치 - x64 Gen2 | SnapCenter 서버 호스팅 


| 오라클 데이터베이스 | 버전 19.18 | 패치 p34765931_190000_Linux-x86-64.zip 


| 오라클 OPatch | 버전 12.2.0.1.36 | 패치 p6880880_190000_Linux-x86-64.zip 


| SnapCenter 서버 | 버전 5.0 | 작업 그룹 배포 


| JDK를 엽니다 | 버전 java-11-openjdk | DB VM의 SnapCenter 플러그인 요구 사항 


| NFS | 버전 3.0 | Oracle dNFS 활성화됨 


| 앤서블 | 코어 2.16.2 | 파이썬 3.6.8 
|===


=== 랩 환경에서의 Oracle 데이터베이스 구성

[cols="33%, 33%, 33%"]
|===


3+|  


| *섬기는 사람* | *데이터 베이스* | *DB 스토리지* 


| 오라-01 | NTAP1(NTAP1_PDB1, NTAP1_PDB2, NTAP1_PDB3) | /u01, /u02, /u03 ANF 용량 풀에 NFS 마운트 


| 오라-02 | NTAP2(NTAP2_PDB1, NTAP2_PDB2, NTAP2_PDB3) | /u01, /u02, /u03 ANF 용량 풀에 NFS 마운트 
|===


=== 배포 고려사항의 핵심 요소

* * SnapCenter 배포.*  SnapCenter Windows 도메인이나 작업 그룹 환경에 배포할 수 있습니다.  도메인 기반 배포의 경우, 도메인 사용자 계정은 도메인 관리자 계정이어야 하거나 도메인 사용자가 SnapCenter 호스팅 서버의 로컬 관리자 그룹에 속해야 합니다.
* *이름 확인.*  SnapCenter 서버는 각 관리 대상 데이터베이스 서버 호스트에 대한 이름을 IP 주소로 확인해야 합니다.  각 대상 데이터베이스 서버 호스트는 SnapCenter 서버 이름을 IP 주소로 확인해야 합니다.  DNS 서버를 사용할 수 없는 경우 로컬 호스트 파일에 이름을 추가하여 확인합니다.
* *리소스 그룹 구성.*  SnapCenter 의 리소스 그룹은 함께 백업할 수 있는 유사한 리소스를 논리적으로 그룹화한 것입니다.  따라서 대규모 데이터베이스 환경에서 백업 작업이 간소화되고 작업 수가 줄어듭니다.
* *전체 데이터베이스와 보관 로그를 별도로 백업합니다.*  전체 데이터베이스 백업에는 데이터 볼륨과 로그 볼륨의 일관된 그룹 스냅샷이 포함됩니다.  전체 데이터베이스 스냅샷을 자주 실행하면 스토리지 사용량이 늘어나지만 RTO는 향상됩니다.  대안은 전체 데이터베이스 스냅샷을 덜 자주 수행하고 보관 로그 백업을 더 자주 수행하는 것입니다. 이를 통해 스토리지 사용량을 줄이고 RPO를 개선할 수 있지만 RTO는 연장될 수 있습니다.  백업 계획을 세울 때 RTO와 RPO 목표를 고려하세요.  볼륨의 스냅샷 백업 수에는 제한(1023)이 있습니다.
* * Privileges 위임.*  원하는 경우 SnapCenter UI에 내장된 역할 기반 액세스 제어를 활용하여 애플리케이션 및 데이터베이스 팀에 권한을 위임합니다.




== 솔루션 구축

다음 섹션에서는 Azure 클라우드의 Azure NetApp Files 에서 SnapCenter 배포, 구성하고 Oracle 데이터베이스를 백업, 복구 및 복제하는 단계별 절차를 제공합니다.



=== 배포를 위한 전제 조건

[%collapsible%open]
====
배포에는 Azure의 ANF에서 실행되는 기존 Oracle 데이터베이스가 필요합니다.  그렇지 않은 경우 아래 단계에 따라 솔루션 검증을 위해 두 개의 Oracle 데이터베이스를 만드세요.  자동화를 통해 Azure 클라우드의 ANF에 Oracle 데이터베이스를 배포하는 방법에 대한 자세한 내용은 TR-4987을 참조하세요.link:../automation/automation-ora-anf-nfs.html["NFS를 사용한 Azure NetApp Files 에서의 간소화되고 자동화된 Oracle 배포"^]

. Azure 계정이 설정되었고, Azure 계정 내에 필요한 VNet 및 네트워크 세그먼트가 생성되었습니다.
. Azure 클라우드 포털에서 Azure Linux VM을 Oracle DB 서버로 배포합니다.  Oracle 데이터베이스에 대한 Azure NetApp Files 용량 풀과 데이터베이스 볼륨을 만듭니다.  azureuser가 DB 서버에 대해 VM SSH 개인/공개 키 인증을 활성화합니다.  환경 설정에 대한 자세한 내용은 이전 섹션의 아키텍처 다이어그램을 참조하세요.  또한 참조됨link:azure-ora-nfile-procedures.html["Azure VM 및 Azure NetApp Files 대한 단계별 Oracle 배포 절차"^] 자세한 내용은.
+

NOTE: 로컬 디스크 중복성을 사용하여 배포된 Azure VM의 경우 Oracle 설치 파일을 준비하고 OS 스왑 파일을 추가할 수 있는 충분한 공간을 확보하기 위해 VM 루트 디스크에 최소 128G를 할당했는지 확인하세요.  /tmplv와 /rootlv OS 파티션을 그에 맞게 확장합니다.  데이터베이스 볼륨 이름이 VMname-u01, VMname-u02, VMname-u03 규칙을 따르는지 확인하세요.

+
[source, cli]
----
sudo lvresize -r -L +20G /dev/mapper/rootvg-rootlv
----
+
[source, cli]
----
sudo lvresize -r -L +10G /dev/mapper/rootvg-tmplv
----
. Azure 클라우드 포털에서 Windows 서버를 프로비저닝하여 최신 버전의 NetApp SnapCenter UI 도구를 실행합니다.  자세한 내용은 다음 링크를 참조하세요.link:https://docs.netapp.com/us-en/snapcenter/install/task_install_the_snapcenter_server_using_the_install_wizard.html["SnapCenter 서버 설치"^] .
. 최신 버전의 Ansible과 Git이 설치된 Ansible 컨트롤러 노드로 Linux VM을 프로비저닝합니다.  자세한 내용은 다음 링크를 참조하세요.link:https://docs.netapp.com/us-en/netapp-solutions-dataops/automation/getting-started.html["NetApp 솔루션 자동화 시작하기^"^] 섹션에서 -
`Setup the Ansible Control Node for CLI deployments on RHEL / CentOS` 또는
`Setup the Ansible Control Node for CLI deployments on Ubuntu / Debian` .
+

NOTE: Ansible 컨트롤러 노드는 ssh 포트를 통해 Azure DB VM에 연결할 수 있는 한 온프레미스 또는 Azure 클라우드에 위치할 수 있습니다.

. NFS용 NetApp Oracle 배포 자동화 툴킷의 사본을 복제합니다.  지침을 따르세요link:../automation/automation-ora-anf-nfs.html["TR-4887"^] 플레이북을 실행합니다.
+
[source, cli]
----
git clone https://bitbucket.ngage.netapp.com/scm/ns-bb/na_oracle_deploy_nfs.git
----
. Azure DB VM /tmp/archive 디렉터리에 777 권한이 있는 Oracle 19c 설치 파일을 다음 단계로 진행합니다.
+
....
installer_archives:
  - "LINUX.X64_193000_db_home.zip"
  - "p34765931_190000_Linux-x86-64.zip"
  - "p6880880_190000_Linux-x86-64.zip"
....
. 다음 영상을 시청해보세요:
+
.SnapCenter 사용한 ANF에서의 Oracle 데이터베이스 백업, 복구 및 복제
video::960fb370-c6e0-4406-b6d5-b110014130e8[panopto,width=360]
. 검토하다 `Get Started` 온라인 메뉴.


====


=== SnapCenter 설치 및 설정

[%collapsible%open]
====
온라인으로 진행하는 것을 권장합니다link:https://docs.netapp.com/us-en/snapcenter/index.html["SnapCenter 소프트웨어 설명서"^] SnapCenter 설치 및 구성을 진행하기 전에: .  다음은 Azure ANF에서 Oracle용 SnapCenter software 설치하고 설정하는 단계에 대한 간략한 요약입니다.

. SnapCenter Windows 서버에서 최신 Java JDK를 다운로드하여 설치하세요.link:https://www.java.com/en/["데스크톱 애플리케이션용 Java 가져오기"^] .
. SnapCenter Windows 서버에서 NetApp 지원 사이트에서 SnapCenter 설치 실행 파일의 최신 버전(현재 5.0)을 다운로드하여 설치하세요.link:https://mysupport.netapp.com/site/["NetApp | 지원"^] .
. SnapCenter 서버를 설치한 후 브라우저를 실행하여 포트 8146을 통해 Windows 로컬 관리자 사용자 또는 도메인 사용자 자격 증명으로 SnapCenter 에 로그인합니다.
+
image:snapctr-ora-azure-anf-setup-001.png["이 이미지는 SnapCenter 서버에 대한 로그인 화면을 제공합니다."]

. 검토 `Get Started` 온라인 메뉴.
+
image:snapctr-ora-azure-anf-setup-002.png["이 이미지는 SnapCenter 서버의 온라인 메뉴를 제공합니다."]

. ~ 안에 `Settings-Global Settings` , 확인하다 `Hypervisor Settings` 업데이트를 클릭하세요.
+
image:snapctr-ora-azure-anf-setup-003.png["이 이미지는 SnapCenter 서버에 대한 하이퍼바이저 설정을 제공합니다."]

. 필요한 경우 조정하세요 `Session Timeout` SnapCenter UI를 원하는 간격으로 설정합니다.
+
image:snapctr-ora-azure-anf-setup-004.png["이 이미지는 SnapCenter 서버에 대한 세션 시간 초과를 제공합니다."]

. 필요한 경우 SnapCenter 에 추가 사용자를 추가합니다.
+
image:snapctr-ora-azure-anf-setup-006.png["이 이미지는 SnapCenter 서버에 대한 설정-사용자 및 액세스를 제공합니다."]

. 그만큼 `Roles` 탭에는 다양한 SnapCenter 사용자에게 할당할 수 있는 기본 제공 역할이 나열되어 있습니다.  관리자는 원하는 권한을 가지고 사용자 정의 역할을 생성할 수도 있습니다.
+
image:snapctr-ora-azure-anf-setup-007.png["이 이미지는 SnapCenter 서버에 대한 역할을 제공합니다."]

. 에서 `Settings-Credential` SnapCenter 관리 대상에 대한 자격 증명을 생성합니다.  이 데모 사용 사례에서는 Azure VM에 로그인하려면 Linux 사용자가 필요하고, 용량 풀에 액세스하려면 ANF 자격 증명이 필요합니다.
+
image:snapctr-ora-azure-anf-setup-008.png["이 이미지는 SnapCenter 서버에 대한 자격 증명을 제공합니다."] image:snapctr-ora-azure-anf-setup-009.png["이 이미지는 SnapCenter 서버에 대한 자격 증명을 제공합니다."] image:snapctr-ora-azure-anf-setup-010.png["이 이미지는 SnapCenter 서버에 대한 자격 증명을 제공합니다."]

. 에서 `Storage Systems` 탭, 추가 `Azure NetApp Files` 위에서 자격 증명을 생성했습니다.
+
image:snapctr-ora-azure-anf-setup-011.png["이 이미지는 SnapCenter 서버에 대한 Azure NetApp Files 제공합니다."] image:snapctr-ora-azure-anf-setup-012.png["이 이미지는 SnapCenter 서버에 대한 Azure NetApp Files 제공합니다."]

. 에서 `Hosts` 탭에서 Azure DB VM을 추가하면 Linux에서 Oracle용 SnapCenter 플러그인이 설치됩니다.
+
image:snapctr-ora-azure-anf-setup-013.png["이 이미지는 SnapCenter 서버에 대한 호스트를 제공합니다."] image:snapctr-ora-azure-anf-setup-014.png["이 이미지는 SnapCenter 서버에 대한 호스트를 제공합니다."] image:snapctr-ora-azure-anf-setup-015.png["이 이미지는 SnapCenter 서버에 대한 호스트를 제공합니다."]

. 호스트 플러그인이 DB 서버 VM에 설치되면 호스트의 데이터베이스가 자동으로 검색되어 표시됩니다. `Resources` 꼬리표.  으로 돌아가기 `Settings-Polices` , 전체 Oracle 데이터베이스 온라인 백업 및 보관 로그 전용 백업에 대한 백업 정책을 만듭니다.  이 문서를 참조하세요link:https://docs.netapp.com/us-en/snapcenter/protect-sco/task_create_backup_policies_for_oracle_database.html["Oracle 데이터베이스에 대한 백업 정책 생성"^] 자세한 단계별 절차는 다음과 같습니다.
+
image:snapctr-ora-azure-anf-setup-005.png["이 이미지는 SnapCenter 서버에 대한 설정 정책을 제공합니다."]



====


=== 데이터베이스 백업

[%collapsible%open]
====
NetApp 스냅샷 백업은 시스템 장애나 데이터 손실이 발생한 경우 복원하는 데 사용할 수 있는 데이터베이스 볼륨의 특정 시점 이미지를 생성합니다.  스냅샷 백업은 보통 1분 이내에 완료됩니다.  백업 이미지는 최소한의 저장 공간을 사용하고 마지막 스냅샷 복사본이 만들어진 이후 파일에 변경된 내용만 기록하므로 성능 오버헤드가 무시할 수 있을 정도입니다.  다음 섹션에서는 SnapCenter 에서 Oracle 데이터베이스 백업을 위한 스냅샷 구현을 보여줍니다.

. 로 이동 `Resources` SnapCenter 플러그인이 데이터베이스 VM에 설치된 후 검색된 데이터베이스를 나열하는 탭입니다.  처음에는 `Overall Status` 데이터베이스의 표시는 다음과 같습니다. `Not protected` .
+
image:snapctr-ora-azure-anf-bkup-001.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."]

. 클릭해주세요 `View` 변경할 드롭다운 `Resource Group` .  클릭해주세요 `Add` 리소스 그룹을 추가하려면 오른쪽에 있는 기호를 클릭하세요.
+
image:snapctr-ora-azure-anf-bkup-002.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."]

. 리소스 그룹, 태그 및 사용자 정의 이름을 지정합니다.
+
image:snapctr-ora-azure-anf-bkup-003.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."]

. 리소스를 추가하세요 `Resource Group` .  유사한 리소스를 그룹화하면 대규모 환경에서 데이터베이스 관리가 간소화될 수 있습니다.
+
image:snapctr-ora-azure-anf-bkup-004.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."]

. 백업 정책을 선택하고 '+' 기호를 클릭하여 일정을 설정하세요. `Configure Schedules` .
+
image:snapctr-ora-azure-anf-bkup-005.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."] image:snapctr-ora-azure-anf-bkup-006.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."]

. 정책에 백업 검증이 구성되어 있지 않으면 검증 페이지를 그대로 두세요.
+
image:snapctr-ora-azure-anf-bkup-007.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."]

. 백업 보고서와 알림을 이메일로 보내려면 해당 환경에 SMTP 메일 서버가 필요합니다.  메일 서버가 설정되지 않은 경우에는 검은색으로 두세요.
+
image:snapctr-ora-azure-anf-bkup-008.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."]

. 새로운 리소스 그룹 요약.
+
image:snapctr-ora-azure-anf-bkup-009.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."]

. 위의 절차를 반복하여 해당 백업 정책에 따라 데이터베이스 보관 로그 전용 백업을 만듭니다.
+
image:snapctr-ora-azure-anf-bkup-010-a.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."]

. 리소스 그룹을 클릭하면 해당 그룹에 포함된 리소스가 표시됩니다.  예약된 백업 작업 외에도 다음을 클릭하여 일회성 백업을 트리거할 수 있습니다. `Backup Now` .
+
image:snapctr-ora-azure-anf-bkup-010.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."] image:snapctr-ora-azure-anf-bkup-011.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."]

. 실행 중인 작업을 클릭하면 모니터링 창이 열리고, 운영자는 이를 통해 작업 진행 상황을 실시간으로 추적할 수 있습니다.
+
image:snapctr-ora-azure-anf-bkup-012.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."]

. 백업 작업이 성공적으로 완료되면 데이터베이스 토폴로지 아래에 스냅샷 백업 세트가 나타납니다.  전체 데이터베이스 백업 세트에는 데이터베이스 데이터 볼륨의 스냅샷과 데이터베이스 로그 볼륨의 스냅샷이 포함됩니다.  로그 전용 백업에는 데이터베이스 로그 볼륨의 스냅샷만 포함됩니다.
+
image:snapctr-ora-azure-anf-bkup-013.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 백업을 제공합니다."]



====


=== 데이터베이스 복구

[%collapsible%open]
====
SnapCenter 통한 데이터베이스 복구는 데이터베이스 볼륨 이미지의 스냅샷 복사본을 특정 시점으로 복원합니다.  그런 다음 데이터베이스는 SCN/타임스탬프에 따라 원하는 지점으로 롤포워드되거나 백업 세트에 있는 사용 가능한 보관 로그에서 허용하는 지점으로 롤포워드됩니다.  다음 섹션에서는 SnapCenter UI를 사용한 데이터베이스 복구 워크플로를 보여줍니다.

. 에서 `Resources` 탭, 데이터베이스 열기 `Primary Backup(s)` 페이지.  데이터베이스 데이터 볼륨의 스냅샷을 선택한 다음 클릭하세요. `Restore` 데이터베이스 복구 워크플로를 시작하는 버튼입니다.  Oracle SCN 또는 타임스탬프로 복구를 실행하려면 백업 세트의 SCN 번호 또는 타임스탬프를 기록해 두세요.
+
image:snapctr-ora-azure-anf-restore-001.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복원을 제공합니다."]

. 선택하다 `Restore Scope` .  컨테이너 데이터베이스의 경우 SnapCenter 전체 컨테이너 데이터베이스(모든 데이터 파일), 플러그형 데이터베이스 또는 테이블스페이스 수준 복원을 수행하는 데 유연합니다.
+
image:snapctr-ora-azure-anf-restore-002.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복원을 제공합니다."]

. 선택하다 `Recovery Scope` . `All logs` 백업 세트에 있는 사용 가능한 모든 보관 로그를 적용하는 것을 의미합니다.  SCN이나 타임스탬프를 통한 특정 시점 복구도 가능합니다.
+
image:snapctr-ora-azure-anf-restore-003.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복원을 제공합니다."]

. 그만큼 `PreOps` 복원/복구 작업 전에 데이터베이스에 대한 스크립트 실행을 허용합니다.
+
image:snapctr-ora-azure-anf-restore-004.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복원을 제공합니다."]

. 그만큼 `PostOps` 복원/복구 작업 후 데이터베이스에 대한 스크립트 실행을 허용합니다.
+
image:snapctr-ora-azure-anf-restore-005.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복원을 제공합니다."]

. 원하시면 이메일로 알려드립니다.
+
image:snapctr-ora-azure-anf-restore-006.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복원을 제공합니다."]

. 작업 요약 복원
+
image:snapctr-ora-azure-anf-restore-007.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복원을 제공합니다."]

. 실행 중인 작업을 클릭하여 엽니다. `Job Details` 창문.  작업 상태는 다음에서도 열어서 볼 수 있습니다. `Monitor` 꼬리표.
+
image:snapctr-ora-azure-anf-restore-008.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복원을 제공합니다."]



====


=== 데이터베이스 복제

[%collapsible%open]
====
SnapCenter 통한 데이터베이스 복제는 볼륨의 스냅샷에서 새 볼륨을 생성하여 수행됩니다.  시스템은 스냅샷 정보를 사용하여 스냅샷이 촬영되었을 때 볼륨의 데이터를 사용하여 새 볼륨을 복제합니다.  더 중요한 점은 개발이나 테스트를 지원하기 위해 프로덕션 데이터베이스의 복제본을 만드는 데 다른 방법에 비해 빠르고(몇 분) 효율적이라는 것입니다.  이를 통해 데이터베이스 애플리케이션 수명 주기 관리가 획기적으로 개선됩니다.  다음 섹션에서는 SnapCenter UI를 사용한 데이터베이스 복제 워크플로를 보여줍니다.

. 에서 `Resources` 탭, 데이터베이스 열기 `Primary Backup(s)` 페이지.  데이터베이스 데이터 볼륨의 스냅샷을 선택한 다음 클릭하세요. `clone` 데이터베이스 복제 워크플로를 시작하는 버튼입니다.
+
image:snapctr-ora-azure-anf-clone-001.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복제본을 제공합니다."]

. 복제 데이터베이스의 SID를 지정합니다.  선택적으로 컨테이너 데이터베이스의 경우 PDB 수준에서도 복제를 수행할 수 있습니다.
+
image:snapctr-ora-azure-anf-clone-002.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복제본을 제공합니다."]

. 복제된 데이터베이스 사본을 저장할 DB 서버를 선택하세요.  파일 이름을 다르게 지정하지 않는 한 기본 파일 위치를 그대로 유지하세요.
+
image:snapctr-ora-azure-anf-clone-003.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복제본을 제공합니다."]

. 소스 데이터베이스와 동일한 Oracle 소프트웨어 스택이 복제 DB 호스트에 설치 및 구성되어야 합니다.  기본 자격 증명을 유지하지만 변경합니다. `Oracle Home Settings` 복제 DB 호스트의 설정과 일치하도록 합니다.
+
image:snapctr-ora-azure-anf-clone-004.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복제본을 제공합니다."]

. 그만큼 `PreOps` 복제 작업 전에 스크립트 실행을 허용합니다.  복제 DB 요구 사항과 프로덕션 데이터베이스 요구 사항(예: SGA 대상 축소)을 충족하도록 데이터베이스 매개변수를 조정할 수 있습니다.
+
image:snapctr-ora-azure-anf-clone-005.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복제본을 제공합니다."]

. 그만큼 `PostOps` 복제 작업 후 데이터베이스에 대한 스크립트 실행을 허용합니다.  복제 데이터베이스 복구는 SCN, 타임스탬프 기반 또는 Until cancel(백업 세트의 마지막 보관된 로그로 데이터베이스를 롤포워드) 방식으로 수행될 수 있습니다.
+
image:snapctr-ora-azure-anf-clone-006.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복제본을 제공합니다."]

. 원하시면 이메일로 알려드립니다.
+
image:snapctr-ora-azure-anf-clone-007.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복제본을 제공합니다."]

. 복제 작업 요약.
+
image:snapctr-ora-azure-anf-clone-008.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복제본을 제공합니다."]

. 실행 중인 작업을 클릭하여 엽니다. `Job Details` 창문.  작업 상태는 다음에서도 열어서 볼 수 있습니다. `Monitor` 꼬리표.
+
image:snapctr-ora-azure-anf-clone-009.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복원을 제공합니다."]

. 복제된 데이터베이스는 SnapCenter 에 즉시 등록됩니다.
+
image:snapctr-ora-azure-anf-clone-010.png["이 이미지는 SnapCenter 서버에 대한 데이터베이스 복원을 제공합니다."]

. DB 서버 호스트에서 복제 데이터베이스를 검증합니다.  복제된 개발 데이터베이스의 경우 데이터베이스 보관 모드를 꺼야 합니다.
+
....

[azureuser@ora-02 ~]$ sudo su
[root@ora-02 azureuser]# su - oracle
Last login: Tue Feb  6 16:26:28 UTC 2024 on pts/0

[oracle@ora-02 ~]$ uname -a
Linux ora-02 4.18.0-372.9.1.el8.x86_64 #1 SMP Fri Apr 15 22:12:19 EDT 2022 x86_64 x86_64 x86_64 GNU/Linux
[oracle@ora-02 ~]$ df -h
Filesystem                                       Size  Used Avail Use% Mounted on
devtmpfs                                         7.7G     0  7.7G   0% /dev
tmpfs                                            7.8G     0  7.8G   0% /dev/shm
tmpfs                                            7.8G   49M  7.7G   1% /run
tmpfs                                            7.8G     0  7.8G   0% /sys/fs/cgroup
/dev/mapper/rootvg-rootlv                         22G   17G  5.6G  75% /
/dev/mapper/rootvg-usrlv                          10G  2.0G  8.1G  20% /usr
/dev/mapper/rootvg-homelv                       1014M   40M  975M   4% /home
/dev/sda1                                        496M  106M  390M  22% /boot
/dev/mapper/rootvg-varlv                         8.0G  958M  7.1G  12% /var
/dev/sda15                                       495M  5.9M  489M   2% /boot/efi
/dev/mapper/rootvg-tmplv                          12G  8.4G  3.7G  70% /tmp
tmpfs                                            1.6G     0  1.6G   0% /run/user/54321
172.30.136.68:/ora-02-u03                        250G  2.1G  248G   1% /u03
172.30.136.68:/ora-02-u01                        100G   10G   91G  10% /u01
172.30.136.68:/ora-02-u02                        250G  7.5G  243G   3% /u02
tmpfs                                            1.6G     0  1.6G   0% /run/user/1000
tmpfs                                            1.6G     0  1.6G   0% /run/user/0
172.30.136.68:/ora-01-u02-Clone-020624161543077  250G  8.2G  242G   4% /u02_ntap1dev

[oracle@ora-02 ~]$ cat /etc/oratab
#
# This file is used by ORACLE utilities.  It is created by root.sh
# and updated by either Database Configuration Assistant while creating
# a database or ASM Configuration Assistant while creating ASM instance.

# A colon, ':', is used as the field terminator.  A new line terminates
# the entry.  Lines beginning with a pound sign, '#', are comments.
#
# Entries are of the form:
#   $ORACLE_SID:$ORACLE_HOME:<N|Y>:
#
# The first and second fields are the system identifier and home
# directory of the database respectively.  The third field indicates
# to the dbstart utility that the database should , "Y", or should not,
# "N", be brought up at system boot time.
#
# Multiple entries with the same $ORACLE_SID are not allowed.
#
#
NTAP2:/u01/app/oracle/product/19.0.0/NTAP2:Y
# SnapCenter Plug-in for Oracle Database generated entry (DO NOT REMOVE THIS LINE)
ntap1dev:/u01/app/oracle/product/19.0.0/NTAP2:N


[oracle@ora-02 ~]$ export ORACLE_SID=ntap1dev
[oracle@ora-02 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Tue Feb 6 16:29:02 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode, log_mode from v$database;

NAME      OPEN_MODE            LOG_MODE
--------- -------------------- ------------
NTAP1DEV  READ WRITE           ARCHIVELOG


SQL> shutdown immediate;
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL> startup mount;
ORACLE instance started.

Total System Global Area 3221223168 bytes
Fixed Size                  9168640 bytes
Variable Size             654311424 bytes
Database Buffers         2550136832 bytes
Redo Buffers                7606272 bytes
Database mounted.

SQL> alter database noarchivelog;

Database altered.

SQL> alter database open;

Database altered.

SQL> select name, open_mode, log_mode from v$database;

NAME      OPEN_MODE            LOG_MODE
--------- -------------------- ------------
NTAP1DEV  READ WRITE           NOARCHIVELOG

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP1_PDB1                     MOUNTED
         4 NTAP1_PDB2                     MOUNTED
         5 NTAP1_PDB3                     MOUNTED

SQL> alter pluggable database all open;

....


====


== 추가 정보를 찾을 수 있는 곳

이 문서에 설명된 정보에 대해 자세히 알아보려면 다음 문서 및/또는 웹사이트를 검토하세요.

* Azure NetApp Files
+
link:https://azure.microsoft.com/en-us/products/netapp["https://azure.microsoft.com/en-us/products/netapp"^]

* SnapCenter 소프트웨어 설명서
+
link:https://docs.netapp.com/us-en/snapcenter/index.html["https://docs.netapp.com/us-en/snapcenter/index.html"^]

* TR-4987: NFS를 사용한 Azure NetApp Files 에서의 간소화되고 자동화된 Oracle 배포
+
link:../automation/automation-ora-anf-nfs.html["배포 절차"]


