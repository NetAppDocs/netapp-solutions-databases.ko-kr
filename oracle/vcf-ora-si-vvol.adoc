---
sidebar: sidebar 
permalink: oracle/vcf-ora-si-vvol.html 
keywords: Database, Oracle, AWS, FSx ONTAP, VMC, VMware 
summary: '이 솔루션은 vSphere Virtual Volumes(vVols)를 기본 데이터베이스 스토리지로 사용하고 단일 인스턴스(SI) 구성에서 Oracle 데이터베이스를 사용하여 VMware Cloud Foundation(VCF)에서 Oracle을 배포하고 보호하기 위한 개요와 세부 정보를 제공합니다.' 
---
= TR-4996: vVols 사용한 VCF에서의 Oracle SI 배포 및 보호
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


Allen Cao, Niyaz Mohamed, NetApp

[role="lead"]
이 솔루션은 vSphere Virtual Volumes(vVols)를 기본 데이터베이스 스토리지로 사용하고 단일 인스턴스(SI) 구성에서 Oracle 데이터베이스를 사용하여 VMware Cloud Foundation(VCF)에서 Oracle을 배포하고 보호하기 위한 개요와 세부 정보를 제공합니다.



== 목적

VMware vSphere Virtual Volumes(vVols)는 가상 디스크를 기본 스토리지 개체로 노출하고 가상 디스크 수준에서 어레이 기반 작업을 지원하는 SAN/NAS 관리 및 통합 프레임워크입니다.  즉, vVols SAN/NAS 장치가 VM을 인식할 수 있도록 하고, 단일 가상 디스크 단위로 VM 중심 접근 방식을 통해 어레이 기반 데이터 서비스를 활용할 수 있는 기능을 제공합니다. vVols 통해 고객은 현재 스토리지 투자의 고유한 기능을 활용하고 모든 스토리지 유형에서 작동하는 가상 환경에 최적화된 더 간단하고 효율적인 운영 모델로 중단 없이 전환할 수 있습니다.

이 문서는 NetApp ONTAP 스토리지 클러스터의 기본 데이터베이스 스토리지로 vVols 사용하는 VMware Cloud Foundation 환경에서 Oracle 단일 인스턴스 데이터베이스를 배포하고 보호하는 방법을 보여줍니다.  Oracle 데이터베이스는 로컬 스토리지 시스템의 로컬 파일 시스템에 배포된 것처럼 구성됩니다.  이 기술 보고서는 Oracle 배포를 위해 VCF에서 vVols 만드는 단계에 초점을 맞춥니다.  또한 VCF에서 저장 효율적인 데이터베이스 운영을 위한 개발/테스트 또는 기타 사용 사례를 위해 NetApp SnapCenter UI 도구를 사용하여 Oracle 데이터베이스를 백업, 복원 및 복제하는 방법을 보여드립니다.

이 솔루션은 다음과 같은 사용 사례를 해결합니다.

* NetApp ONTAP AFF 의 vVols 데이터 저장소를 기본 데이터베이스 저장소로 사용하여 VCF에 Oracle SI 데이터베이스 배포
* NetApp SnapCenter UI 도구를 사용하여 vVols 데이터 저장소를 포함한 VCF에서 Oracle 데이터베이스 백업 및 복원
* NetApp SnapCenter UI 도구를 사용하여 vVols 데이터 저장소가 있는 VCF에서 개발/테스트 또는 기타 사용 사례를 위한 Oracle 데이터베이스 복제




== 대상

이 솔루션은 다음과 같은 사람들을 위해 만들어졌습니다.

* NetApp ONTAP AFF 의 vVols 데이터 저장소를 기본 데이터베이스 저장소로 사용하여 VCF에서 Oracle을 배포하려는 DBA
* NetApp ONTAP AFF 스토리지의 vVols 데이터 저장소를 사용하여 VCF에서 Oracle 워크로드를 테스트하려는 데이터베이스 솔루션 아키텍트
* NetApp ONTAP AFF 스토리지에 vVols 데이터 저장소를 사용하여 VCF에 배포된 Oracle 데이터베이스를 배포하고 관리하려는 스토리지 관리자
* vVol 데이터 저장소를 사용하여 VCF에서 Oracle 데이터베이스를 구축하려는 애플리케이션 소유자




== 솔루션 테스트 및 검증 환경

이 솔루션의 테스트 및 검증은 NetApp ONTAP AFF 스토리지의 vVols 데이터 저장소가 있는 VCF를 사용하는 랩 환경에서 수행되었으며, 이는 최종 배포 환경과 일치하지 않을 수 있습니다. 자세한 내용은 다음 섹션을 참조하세요. <<배포 고려사항의 핵심 요소>> .



=== 아키텍처

image:vcf-ora-si-vvols-architecture.png["이 이미지는 iSCSI 및 ASM을 사용한 AWS 퍼블릭 클라우드의 Oracle 배포 구성에 대한 자세한 그림을 제공합니다."]



=== 하드웨어 및 소프트웨어 구성 요소

[cols="33%, 33%, 33%"]
|===


3+| *하드웨어* 


| NetApp ONTAP AFF A300 | 버전 9.14.1P4 | 24개의 NVMe 디스크를 탑재한 DS224 쉘프, 총 용량 35.2TiB 


| VMware VSphere 클러스터 | 버전 8.02 | 12개 CPU x Intel(R) Xeon(R) Gold 5218 CPU @ 2.30GHz, 8개 노드(4개 관리 도메인 및 4개 워크로드 도메인) 


3+| *소프트웨어* 


| 레드햇 리눅스 | RHEL-8.6, 4.18.0-372.9.1.el8.x86_64 커널 | Oracle DB 서버 호스팅, 테스트를 위해 RedHat 구독 배포 


| 윈도우 서버 | 2022 표준, 10.0.20348 빌드 20348 | SnapCenter 서버 호스팅 


| 센토스 리눅스 | CentOS 리눅스 릴리스 8.5.2111 | Ansible 컨트롤러 호스팅 


| 오라클 데이터베이스 | 버전 19.18 | RU 패치 p34765931_190000_Linux-x86-64.zip을 적용했습니다. 


| 오라클 OPatch | 버전 12.2.0.1.36 | 최신 패치 p6880880_190000_Linux-x86-64.zip 


| SnapCenter 서버 | 버전 6.0 | 작업 그룹 배포 


| SnapCenter Plug-in for VMware vSphere | 버전 6.0 | vSphere 클러스터에 OVA VM으로 배포됨 


| VMware vSphere용 ONTAP 도구 | 버전 9.13 | vSphere 클러스터에 OVA VM으로 배포됨 


| JDK를 엽니다 | 버전 java-11-openjdk-11.0.23.0.9-3.el8.x86_64 | DB VM의 SnapCenter 플러그인 요구 사항 
|===


=== VCF의 Oracle 데이터베이스 구성

[cols="33%, 33%, 33%"]
|===


3+|  


| *섬기는 사람* | *데이터 베이스* | *DB 스토리지* 


| ora_01 | NTAP1(NTAP1_pdb1, NTAP1_pdb2, NTAP1_pdb3) | NetApp ONTAP AFF A300 의 vVols 데이터 저장소 


| ora_02 | NTAP2(NTAP2_pdb1,NTAP2_pdb2,NTAP2_pdb3), NTAP1CLN | NetApp ONTAP AFF A300 의 vVols 데이터 저장소 
|===


=== 배포 고려사항의 핵심 요소

* * vVols 와 ONTAP 클러스터 연결을 위한 프로토콜입니다.*  NFS나 iSCSI가 좋은 선택입니다.  성능 수준은 동일합니다.  이 솔루션 데모에서는 밑줄 친 ONTAP 스토리지 클러스터에 대한 vVols 연결을 위한 스토리지 프로토콜로 NFS를 사용했습니다.  VCF 인프라가 지원하는 경우 FC/FCoE, NVMe/FC 프로토콜도 NetApp ONTAP 의 vVols 데이터 저장소에 대해 지원됩니다.
* * vVols 데이터 저장소의 Oracle 스토리지 레이아웃.*  테스트와 검증 과정에서 Oracle 바이너리, Oracle 데이터, Oracle 로그 파일에 대한 세 개의 vVols 데이터 저장소를 배포했습니다.  데이터베이스 백업, 복구 또는 복제를 쉽게 관리하고 실행할 수 있도록 다양한 유형의 Oracle 파일을 해당 데이터 저장소로 분리하는 것이 좋습니다.  대규모 데이터베이스에는 전용 vVols 만들고, 소규모 데이터베이스나 유사한 QoS 프로필을 가진 데이터베이스에는 vVols 공유합니다. 
* * ONTAP 스토리지 인증을 위한 자격 증명.*  SnapCenter ONTAP 스토리지 클러스터의 연결이나 ONTAP 도구와 ONTAP 스토리지 클러스터의 연결을 포함하여 ONTAP 스토리지 클러스터 인증에는 ONTAP 클러스터 수준 자격 증명만 사용하세요.
* * vVols 데이터 저장소에서 데이터베이스 VM으로 스토리지를 프로비저닝합니다.*  vVols 데이터 저장소에서 데이터베이스 VM에 한 번에 하나의 디스크만 추가합니다.  현재 vVols 데이터 저장소에서 여러 디스크를 동시에 추가하는 것은 지원되지 않습니다.  
* *데이터베이스 보호.*  NetApp 사용자 친화적인 UI 인터페이스를 통해 데이터베이스 백업, 복원 및 복제를 위한 SnapCenter software 제품군을 제공합니다.  NetApp 빠른(1분 이내) 스냅샷 백업, 빠른(분) 데이터베이스 복원 및 데이터베이스 복제를 달성하기 위해 이러한 관리 도구를 구현할 것을 권장합니다.




== 솔루션 구축

다음 섹션에서는 Oracle 단일 인스턴스 구성의 NetApp ONTAP 스토리지에 vVols 데이터 저장소를 사용하여 VCF에서 Oracle 19c를 배포하는 단계별 절차를 제공합니다.



=== 배포를 위한 전제 조건

[%collapsible%open]
====
배포에는 다음과 같은 전제 조건이 필요합니다.

. VMware VCF가 설정되었습니다.  VCF를 만드는 방법에 대한 정보나 지침은 VMware 설명서를 참조하세요.link:https://docs.vmware.com/en/VMware-Cloud-Foundation/index.html["VMware Cloud Foundation 문서"^] .
. VCF 워크로드 도메인 내에서 Linux VM 3개, Oracle 데이터베이스용 VM 2개, Ansible 컨트롤러용 VM 1개를 프로비저닝합니다.  NetApp SnapCenter 서버를 실행하기 위해 하나의 Windows 서버 VM을 프로비저닝합니다.  자동화된 Oracle 데이터베이스 배포를 위한 Ansible 컨트롤러 설정에 대한 정보는 다음 리소스를 참조하세요.link:https://docs.netapp.com/us-en/netapp-solutions-dataops/automation/getting-started.html["NetApp 솔루션 자동화 시작하기^"^] .
. VMware vSphere용 SnapCenter 플러그인 버전 6.0이 VCF에 배포되었습니다.  플러그인 배포에 대한 다음 리소스를 참조하세요.link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/["SnapCenter Plug-in for VMware vSphere 설명서"^] .
. VMware vSphere용 ONTAP 도구가 VCF에 배포되었습니다.  VMware vSphere 배포를 위한 ONTAP 도구에 대한 다음 리소스를 참조하세요.link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["ONTAP tools for VMware vSphere"^]



NOTE: Oracle 설치 파일을 준비할 충분한 공간을 확보하려면 Oracle VM 루트 볼륨에 최소 50G를 할당했는지 확인하세요.

====


=== 저장 용량 프로필 생성

[%collapsible%open]
====
먼저, vVols 데이터 저장소를 호스팅하는 밑줄 친 ONTAP 스토리지에 대한 사용자 지정 스토리지 기능 프로필을 만듭니다.

. vSphere 클라이언트 바로 가기에서 NetApp ONTAP 도구를 엽니다.  ONTAP 스토리지 클러스터가 추가되었는지 확인하세요. `Storage Systems` ONTAP 도구 배포의 일부로.
+
image:vcf-ora-vvol-scp-001.png["사용자 정의 스토리지 기능 프로필 구성을 보여주는 스크린샷입니다."] image:vcf-ora-vvol-scp-008.png["사용자 정의 스토리지 기능 프로필 구성을 보여주는 스크린샷입니다."]

. 클릭해주세요 `Storage capability profile` Oracle에 대한 사용자 정의 프로필을 추가합니다.  프로필의 이름을 지정하고 간략한 설명을 추가하세요.
+
image:vcf-ora-vvol-scp-002.png["사용자 정의 스토리지 기능 프로필 구성을 보여주는 스크린샷입니다."]

. 스토리지 컨트롤러 범주를 선택하세요: 성능, 용량 또는 하이브리드.
+
image:vcf-ora-vvol-scp-003.png["사용자 정의 스토리지 기능 프로필 구성을 보여주는 스크린샷입니다."]

. 프로토콜을 선택하세요.
+
image:vcf-ora-vvol-scp-004.png["사용자 정의 스토리지 기능 프로필 구성을 보여주는 스크린샷입니다."]

. 원하는 경우 QoS 정책을 정의합니다.
+
image:vcf-ora-vvol-scp-005.png["사용자 정의 스토리지 기능 프로필 구성을 보여주는 스크린샷입니다."]

. 프로필에 대한 추가 저장 속성입니다.  암호화 기능을 사용하려면 NetApp 컨트롤러에서 암호화가 활성화되어 있는지 확인하세요. 그렇지 않으면 프로필을 적용할 때 문제가 발생할 수 있습니다.
+
image:vcf-ora-vvol-scp-006.png["사용자 정의 스토리지 기능 프로필 구성을 보여주는 스크린샷입니다."]

. 요약을 검토하고 저장 용량 프로필 생성을 완료합니다.
+
image:vcf-ora-vvol-scp-007.png["사용자 정의 스토리지 기능 프로필 구성을 보여주는 스크린샷입니다."]



====


=== vVols 데이터 저장소 생성 및 구성

[%collapsible%open]
====
필수 구성 요소를 모두 완료한 후 vSphere 클라이언트를 통해 관리자 권한으로 VCF에 로그인하고 워크로드 도메인으로 이동합니다.  vVols 생성하기 위해 기본 제공 VMware 스토리지 옵션을 사용하지 마세요.  대신 NetApp ONTAP 도구를 사용하여 vVols 생성하세요.  다음은 vVols 생성하고 구성하는 절차를 보여줍니다.

. vVols 생성 워크플로는 ONTAP 도구 인터페이스나 VCF 워크로드 도메인 클러스터에서 트리거될 수 있습니다.
+
image:vcf-ora-vvol-datastore-001.png["vVols 데이터 저장소 구성을 보여주는 스크린샷입니다."]

+
image:vcf-ora-vvol-datastore-001-b.png["vVols 데이터 저장소 구성을 보여주는 스크린샷입니다."]

. 프로비저닝 대상, 유형, 이름, 프로토콜을 포함한 데이터 저장소에 대한 일반 정보를 입력합니다.
+
image:vcf-ora-vvol-datastore-002.png["vVols 데이터 저장소 구성을 보여주는 스크린샷입니다."]

. 이전 단계에서 생성된 사용자 정의 스토리지 기능 프로필을 선택하십시오. `Storage system` , 그리고 `Storage VM` vVols 생성할 위치입니다.
+
image:vcf-ora-vvol-datastore-003.png["vVols 데이터 저장소 구성을 보여주는 스크린샷입니다."]

. 선택하다 `Create new volumes` , 볼륨 이름과 크기를 입력하고 클릭하세요. `ADD` 그 다음에 `NEXT` 요약 페이지로 이동합니다.
+
image:vcf-ora-vvol-datastore-004.png["vVols 데이터 저장소 구성을 보여주는 스크린샷입니다."]

+

NOTE: 성능을 위해 vVols 데이터 저장소에 두 개 이상의 볼륨을 추가하거나 여러 ONTAP 컨트롤러 노드에 vVols 데이터 저장소 볼륨을 확장할 수 있습니다.

. 딸깍 하는 소리 `Finish` Oracle 바이너리에 대한 vVols 데이터 저장소를 생성합니다.
+
image:vcf-ora-vvol-datastore-005.png["vVols 데이터 저장소 구성을 보여주는 스크린샷입니다."]

. Oracle 데이터 및 로그에 대한 vVols 데이터 저장소를 생성하려면 동일한 절차를 반복합니다.
+
image:vcf-ora-vvol-datastore-006.png["vVols 데이터 저장소 구성을 보여주는 스크린샷입니다."]




NOTE: Oracle 데이터베이스가 복제되면 데이터에 대한 추가 vVols vVols 목록에 추가됩니다.

====


=== 스토리지 기능 프로필을 기반으로 VM 스토리지 정책 생성

[%collapsible%open]
====
vVols 데이터 저장소에서 데이터베이스 VM으로 스토리지를 프로비저닝하기 전에 이전 단계에서 만든 스토리지 기능 프로필을 기반으로 VM 스토리지 정책을 추가합니다.  절차는 다음과 같습니다.

. vSphere 클라이언트 메뉴에서 열기 `Policies and Profiles` 그리고 강조하다 `VM Storage Policies` .  딸깍 하는 소리 `Create` 열다 `VM Storage Policies` 워크플로.
+
image:vcf-ora-vvol-vm-policy-001.png["VM 스토리지 정책 구성을 보여주는 스크린샷입니다."]

. VM 스토리지 정책의 이름을 지정합니다.
+
image:vcf-ora-vvol-vm-policy-002.png["VM 스토리지 정책 구성을 보여주는 스크린샷입니다."]

. ~ 안에 `Datastore specific rules` , 확인하다 `Enable rules for "NetAPP.clustered.Data.ONTAP.VP.vvol" storage`
+
image:vcf-ora-vvol-vm-policy-003.png["VM 스토리지 정책 구성을 보여주는 스크린샷입니다."]

. NetApp.clustered.Data.ONTAP ONTAP 규칙의 경우 `Placement` , 이전 단계에서 만든 사용자 정의 스토리지 용량 프로필을 선택합니다.
+
image:vcf-ora-vvol-vm-policy-004.png["VM 스토리지 정책 구성을 보여주는 스크린샷입니다."]

. NetApp.clustered.Data.ONTAP ONTAP 규칙의 경우 `Replication` , 선택하다 `Disabled` vVols 복제되지 않은 경우.
+
image:vcf-ora-vvol-vm-policy-004-a.png["VM 스토리지 정책 구성을 보여주는 스크린샷입니다."]

. 저장소 호환성 페이지는 VCF 환경에서 호환되는 vVols 데이터 저장소를 표시합니다.
+
image:vcf-ora-vvol-vm-policy-005.png["VM 스토리지 정책 구성을 보여주는 스크린샷입니다."]

. VM 스토리지 정책을 생성하기 위해 검토하고 완료합니다.
+
image:vcf-ora-vvol-vm-policy-006.png["VM 스토리지 정책 구성을 보여주는 스크린샷입니다."]

. 방금 생성한 VM 스토리지 정책을 검증합니다.
+
image:vcf-ora-vvol-vm-policy-007.png["VM 스토리지 정책 구성을 보여주는 스크린샷입니다."]



====


=== vVols 데이터 저장소에서 DB VM에 디스크를 할당하고 DB 저장소를 구성합니다.

[%collapsible%open]
====
vSphere 클라이언트에서 VM 설정을 편집하여 vVols 데이터 저장소의 세 개 디스크를 데이터베이스 VM에 추가합니다.  그런 다음 VM에 로그인하여 디스크를 포맷하고 마운트 지점 /u01, /u02, /u03에 마운트합니다.  다음은 정확한 단계와 작업을 보여줍니다.

. Oracle 바이너리 스토리지를 위해 VM에 디스크를 추가합니다.
+
image:vcf-ora-vvol-vm-bins.png["VM 스토리지 구성을 보여주는 스크린샷입니다."]

. Oracle 데이터 저장을 위해 VM에 디스크를 추가합니다.
+
image:vcf-ora-vvol-vm-data.png["VM 스토리지 구성을 보여주는 스크린샷입니다."]

. Oracle 로그 저장을 위해 VM에 디스크를 추가합니다.
+
image:vcf-ora-vvol-vm-logs.png["VM 스토리지 구성을 보여주는 스크린샷입니다."]

. VM에서 `Edit Settings` , `Advanced Parameters` , 속성 추가 `disk.enableuuid` 가치 있는 `TRUE` .  고급 매개변수를 추가하려면 VM을 다운해야 합니다.  이 옵션을 설정하면 SnapCenter 사용자 환경에서 vVol을 정확하게 식별할 수 있습니다.
+
image:vcf-ora-vvol-vm-uuid.png["VM 스토리지 구성을 보여주는 스크린샷입니다."]

. 이제 VM을 다시 시작하세요.  ssh를 통해 관리자 권한으로 VM에 로그인하여 새로 추가된 디스크 드라이브를 검토합니다.
+
....
[admin@ora_01 ~]$ sudo fdisk -l

Disk /dev/sdb: 50 GiB, 53687091200 bytes, 104857600 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

Disk /dev/sdc: 100 GiB, 107374182400 bytes, 209715200 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

Disk /dev/sdd: 100 GiB, 107374182400 bytes, 209715200 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

.
.
.
....
. 기본 선택 사항을 적용하여 드라이브를 기본 및 단일 파티션으로 분할합니다.
+
[source, cli]
----
sudo fdisk /dev/sdb
----
+
[source, cli]
----
sudo fdisk /dev/sdc
----
+
[source, cli]
----
sudo fdisk /dev/sdd
----
. 파티션된 디스크를 xfs 파일 시스템으로 포맷합니다.
+
[source, cli]
----
sudo mkfs.xfs /dev/sdb1
----
+
[source, cli]
----
sudo mkfs.xfs /dev/sdc1
----
+
[source, cli]
----
sudo mkfs.xfs /dev/sdd1
----
. 드라이브를 마운트 지점 /u01, /u02, /u03에 마운트합니다.
+
[source, cli]
----
sudo mount -t xfs /dev/sdb1 /u01
----
+
[source, cli]
----
sudo mount -t xfs /dev/sdc1 /u02
----
+
[source, cli]
----
sudo mount -t xfs /dev/sdd1 /u03
----
+
....
[admin@ora_01 ~]$ df -h
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               7.7G     0  7.7G   0% /dev
tmpfs                  7.8G     0  7.8G   0% /dev/shm
tmpfs                  7.8G  782M  7.0G  10% /run
tmpfs                  7.8G     0  7.8G   0% /sys/fs/cgroup
/dev/mapper/rhel-root   44G   19G   26G  43% /
/dev/sda1             1014M  258M  757M  26% /boot
tmpfs                  1.6G   12K  1.6G   1% /run/user/42
tmpfs                  1.6G  4.0K  1.6G   1% /run/user/1000
/dev/sdb1               50G  390M   50G   1% /u01
/dev/sdc1              100G  746M  100G   1% /u02
/dev/sdd1              100G  746M  100G   1% /u03

....
. VM이 재부팅될 때 디스크 드라이브가 마운트되도록 /etc/fstab에 마운트 지점을 추가합니다.
+
[source, cli]
----
sudo vi /etc/fstab
----
+
....
[oracle@ora_01 ~]$ cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Wed Oct 18 19:43:31 2023
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
/dev/mapper/rhel-root   /                       xfs     defaults        0 0
UUID=aff942c4-b224-4b62-807d-6a5c22f7b623 /boot                   xfs     defaults        0 0
/dev/mapper/rhel-swap   none                    swap    defaults        0 0
/root/swapfile swap swap defaults 0 0
/dev/sdb1               /u01                    xfs     defaults        0 0
/dev/sdc1               /u02                    xfs     defaults        0 0
/dev/sdd1               /u03                    xfs     defaults        0 0
....


====


=== VCF에 Oracle 데이터베이스 배포

[%collapsible%open]
====
vVols 사용하여 VCF에 Oracle을 배포하려면 NetApp 자동화 툴킷을 활용하는 것이 좋습니다.  xfs 파일 시스템에서 Oracle 자동 배포를 실행하는 방법에 대한 자세한 내용은 TR-4992를 참조하세요.link:../automation/automation-ora-c-series-nfs.html["NFS를 사용한 NetApp C-Series에서의 간소화되고 자동화된 Oracle 배포"^] .  TR-4992는 NFS를 사용하여 NetApp C-시리즈에 자동화된 Oracle을 배포하는 것을 다루지만, 데이터베이스 VM에 NFS 파일 시스템을 마운트하지 않는 한 vVols 사용하여 VCF에 Oracle을 배포하는 것과 동일합니다.  우리는 특정 태그를 사용해서 간단히 건너뛸 수 있습니다.  단계별 절차는 다음과 같습니다.

. ssh를 통해 Ansible 컨트롤러 VM에 관리자 사용자로 로그인하고 NFS에서 Oracle용 자동화 툴킷 사본을 복제합니다.
+
[source, cli]
----
git clone https://bitbucket.ngage.netapp.com/scm/ns-bb/na_oracle_deploy_nfs.git
----
. 데이터베이스 VM의 /tmp/archive 폴더에 다음 Oracle 설치 파일을 준비합니다.  해당 폴더는 모든 사용자에게 777 권한으로 접근을 허용해야 합니다.
+
....
LINUX.X64_193000_db_home.zip
p34765931_190000_Linux-x86-64.zip
p6880880_190000_Linux-x86-64.zip
....
. TR-4992의 이 섹션에 있는 지침에 따라 배포 대상 파일(hosts), 전역 변수 파일(vars/vars.yml), 로컬 DB VM 변수 파일(host_vars/host_name.yml)을 구성합니다.link:../automation/automation-ora-c-series-nfs.html#parameter-files-configuration["매개변수 파일 구성"^] .  로컬 DB VM 변수 파일에서 nfs_lif 변수를 주석 처리합니다.
. Ansible 컨트롤러와 데이터베이스 VM 간에 ssh 키리스 인증을 설정하려면 ssh 키 쌍을 생성하고 공개 키를 데이터베이스 VM 관리자 루트 디렉토리의 .ssh 폴더 authorized_keys 파일에 복사해야 합니다.
+
[source, cli]
----
ssh-keygen
----
. Ansible 컨트롤러에서 자동화 툴킷 홈 디렉토리 /home/admin/na_oracle_deploy_nf를 복제하고, 필수 구성 요소 플레이북을 실행합니다.
+
[source, cli]
----
ansible-playbook -i hosts 1-ansible_requirements.yml
----
. Linux 구성 플레이북을 실행합니다.
+
[source, cli]
----
ansible-playbook -i hosts 2-linux_config.yml -u admin -e @vars/vars.yml
----
. Oracle 배포 플레이북을 실행합니다.
+
[source, cli]
----
ansible-playbook -i hosts 4-oracle_config.yml -u admin -e @vars/vars.yml --skip-tags "ora_mount_points,enable_dnfs_client"
----
. 선택적으로, 위의 모든 플레이북을 단일 플레이북 실행에서 실행할 수도 있습니다.
+
[source, cli]
----
ansible-playbook -i hosts 0-all_playbook.yml -u admin -e @vars/vars.yml --skip-tags "ora_mount_points,enable_dnfs_client"
----
. 플레이북을 성공적으로 실행한 후 Oracle을 검증하려면 EM express에 로그인하세요.
+
image:vcf-ora-vvol-em-002.png["Oracle EM Express 구성을 보여주는 스크린샷입니다."] image:vcf-ora-vvol-em-001.png["Oracle EM Express 구성을 보여주는 스크린샷입니다."]

. 선택적으로 destroy playbook을 실행하여 DB VM에서 데이터베이스를 제거합니다.
+
[source, cli]
----
ansible-playbook -i hosts 5-destroy.yml -u admin -e @vars/vars.yml
----


====


=== SnapCenter 사용하여 VCF에서 Oracle 백업, 복원 및 복제



==== SnapCenter 설정

[%collapsible%open]
====
SnapCenter 버전 6은 VMware vVols 데이터 저장소 지원을 포함하여 버전 5에 비해 많은 기능이 향상되었습니다.  SnapCenter 데이터베이스 VM의 호스트 측 플러그인을 사용하여 애플리케이션 인식 데이터 보호 관리 활동을 수행합니다.  Oracle용 NetApp SnapCenter 플러그인에 대한 자세한 내용은 이 설명서를 참조하세요.link:https://docs.netapp.com/us-en/snapcenter/protect-sco/concept_what_you_can_do_with_the_snapcenter_plug_in_for_oracle_database.html["Oracle Database용 플러그인으로 무엇을 할 수 있나요?"^] .  다음은 VCF에서 Oracle 데이터베이스 백업, 복구 및 복제를 위해 SnapCenter 버전 6을 설정하는 간단한 단계를 제공합니다.

. NetApp 지원 사이트에서 SnapCenter software 버전 6을 다운로드하세요.link:https://mysupport.netapp.com/site/downloads["NetApp 지원 다운로드"^] .
. Windows VM을 호스팅하는 SnapCenter 에 관리자로 로그인합니다.  SnapCenter 6.0의 필수 구성 요소를 설치합니다.
+
image:vcf-ora-vvol-snapctr-prerequisites.png["SnapCenter 6.0 필수 구성 요소를 보여주는 스크린샷입니다."]

. 관리자 권한으로 최신 Java JDK를 설치하세요.link:https://www.java.com/en/["데스크톱 애플리케이션용 Java 가져오기"^] .
+

NOTE: Windows 서버가 도메인 환경에 배포된 경우 SnapCenter 서버 로컬 관리자 그룹에 도메인 사용자를 추가하고 도메인 사용자로 SnapCenter 설치를 실행합니다.

. 설치 사용자로 HTTPS 포트 8846을 통해 SnapCenter UI에 로그인하여 Oracle용 SnapCenter 구성합니다.
+
image:vcf-ora-vvol-snapctr-deploy-001.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 검토 `Get Started` SnapCenter 처음 사용하는 분이라면 메뉴를 통해 최신 정보를 얻으세요.
+
image:vcf-ora-vvol-snapctr-deploy-002.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 업데이트 `Hypervisor Settings` 글로벌 설정에서.
+
image:aws-ora-fsx-vmc-snapctr-001.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. ONTAP 스토리지 클러스터 추가 `Storage Systems` 클러스터 관리 IP를 사용하고 클러스터 관리자 사용자 ID를 통해 인증합니다.
+
image:vcf-ora-vvol-snapctr-deploy-006.png["SnapCenter 구성을 보여주는 스크린샷입니다."] image:vcf-ora-vvol-snapctr-deploy-007.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 데이터베이스 VM 및 vSphere 플러그인 VM 추가 `Credential` SnapCenter 가 DB VM 및 vSphere 플러그인 VM에 액세스할 수 있도록 합니다.  해당 자격 증명에는 Linux VM에 대한 sudo 권한이 있어야 합니다.  VM의 다양한 관리 사용자 ID에 대해 서로 다른 자격 증명을 만들 수 있습니다.
+
image:aws-ora-fsx-vmc-snapctr-003.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. VCF에 Oracle 데이터베이스 VM 추가 `Hosts` 이전 단계에서 만든 DB VM 자격 증명을 사용합니다.
+
image:vcf-ora-vvol-snapctr-deploy-008.png["SnapCenter 구성을 보여주는 스크린샷입니다."] image:vcf-ora-vvol-snapctr-deploy-009.png["SnapCenter 구성을 보여주는 스크린샷입니다."] image:vcf-ora-vvol-snapctr-deploy-010.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 마찬가지로 NetApp VMware 플러그인 VM을 추가합니다. `Hosts` 이전 단계에서 만든 vSphere 플러그인 VM 자격 증명을 사용합니다.
+
image:vcf-ora-vvol-snapctr-deploy-011.png["SnapCenter 구성을 보여주는 스크린샷입니다."] image:vcf-ora-vvol-snapctr-deploy-012.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 마지막으로 DB VM에서 Oracle 데이터베이스가 발견되면 다시 `Settings`-`Policies` Oracle 데이터베이스 백업 정책을 생성합니다.  이상적으로는 장애 발생 시 데이터 손실을 최소화하기 위해 더 빈번한 백업 간격을 허용하는 별도의 보관 로그 백업 정책을 만드는 것이 좋습니다.
+
image:aws-ora-fsx-vmc-snapctr-002.png["SnapCenter 구성을 보여주는 스크린샷입니다."]




NOTE: SnapCenter 서버 이름을 DB VM 및 vSphere 플러그인 VM의 IP 주소로 확인할 수 있는지 확인하세요.  마찬가지로 DB VM 이름과 vSphere 플러그인 VM 이름은 SnapCenter 서버의 IP 주소로 확인될 수 있습니다.

====


==== 데이터베이스 백업

[%collapsible%open]
====
SnapCenter 기존 RMAN 기반 방법론에 비해 훨씬 빠른 데이터베이스 백업, 복원 또는 복제를 위해 ONTAP 볼륨 스냅샷을 활용합니다.  스냅샷은 스냅샷 전에 데이터베이스가 Oracle 백업 모드로 전환되므로 애플리케이션과 일관성을 유지합니다.

. 에서 `Resources` 탭을 선택하면 SnapCenter 에 VM이 추가된 후 VM의 모든 데이터베이스가 자동으로 검색됩니다.  처음에는 데이터베이스 상태가 다음과 같이 표시됩니다. `Not protected` .
+
image:vcf-ora-vvol-snapctr-bkup-001.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 데이터베이스를 클릭하여 데이터베이스 보호를 활성화하는 워크플로를 시작합니다.
+
image:vcf-ora-vvol-snapctr-bkup-002.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 백업 정책을 적용하고 필요한 경우 일정을 설정합니다.
+
image:vcf-ora-vvol-snapctr-bkup-003.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 필요한 경우 백업 작업 알림을 설정합니다.
+
image:vcf-ora-vvol-snapctr-bkup-005.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 요약을 검토하고 완료하여 데이터베이스 보호를 활성화합니다.
+
image:vcf-ora-vvol-snapctr-bkup-006.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 주문형 백업 작업은 클릭으로 트리거될 수 있습니다. `Back up Now` .
+
image:vcf-ora-vvol-snapctr-bkup-007.png["SnapCenter 구성을 보여주는 스크린샷입니다."] image:vcf-ora-vvol-snapctr-bkup-008.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 백업 작업은 다음에서 모니터링할 수 있습니다. `Monitor` 실행 중인 작업을 클릭하여 탭을 엽니다.
+
image:vcf-ora-vvol-snapctr-bkup-009.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 각 데이터베이스에 대해 완료된 백업 세트를 검토하려면 데이터베이스를 클릭하세요.
+
image:vcf-ora-vvol-snapctr-bkup-010.png["SnapCenter 구성을 보여주는 스크린샷입니다."]



====


==== 데이터베이스 복원/복구

[%collapsible%open]
====
SnapCenter 스냅샷 백업을 통해 Oracle 데이터베이스에 대한 다양한 복원 및 복구 옵션을 제공합니다.  이 예제에서는 이전 스냅샷 백업에서 복원한 다음 마지막으로 사용 가능한 로그로 데이터베이스를 롤포워드하는 방법을 보여줍니다.

. 먼저 스냅샷 백업을 실행합니다.  그런 다음 테스트 테이블을 만들고 테이블에 행을 삽입하여 테스트 테이블 생성 시 테스트 테이블을 다시 생성하기 전에 스냅샷 이미지에서 복구된 데이터베이스의 유효성을 검사합니다.
+
....
[oracle@ora_01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Jul 17 10:20:10 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> sho pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP1_PDB1                     READ WRITE NO
         4 NTAP1_PDB2                     READ WRITE NO
         5 NTAP1_PDB3                     READ WRITE NO
SQL> alter session set container=ntap1_pdb1;

SQL> select * from test;

no rows selected


SQL> insert into test values (1, sysdate, 'test oracle backup/restore/clone on VMware Cloud Foundation vVols');

1 row created.

SQL> commit;

Commit complete.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
18-JUL-24 11.15.03.000000 AM
test oracle backup/restore/clone on VMware Cloud Foundation vVols


SQL>


....
. SnapCenter 에서 `Resources` 탭에서 데이터베이스 NTAP1 백업 토폴로지 페이지를 엽니다.  테스트 테이블을 생성하기 전에 스냅샷 데이터 백업 세트를 강조 표시합니다.  클릭해주세요 `Restore` 복원-복구 워크플로를 시작합니다.
+
image:vcf-ora-vvol-snapctr-restore-001.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 복원 범위를 선택하세요.
+
image:vcf-ora-vvol-snapctr-restore-002.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 복구 범위를 선택하세요 `All Logs` .
+
image:vcf-ora-vvol-snapctr-restore-003.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 실행할 선택적 사전 스크립트를 지정합니다.
+
image:vcf-ora-vvol-snapctr-restore-004.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 실행할 선택적 사후 스크립트를 지정합니다.
+
image:vcf-ora-vvol-snapctr-restore-005.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 원하시면 작업 보고서를 보내주세요.
+
image:vcf-ora-vvol-snapctr-restore-006.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 요약을 검토하고 클릭하세요 `Finish` 복구와 회복을 시작합니다.
+
image:vcf-ora-vvol-snapctr-restore-007.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 에서 `Monitor` 탭을 클릭하여 작업을 열어 세부 정보를 검토하세요.
+
image:vcf-ora-vvol-snapctr-restore-008.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. DB VM ora_01에서 데이터베이스의 성공적인 복원/복구가 가장 최근 상태로 롤포워드되고 테스트 테이블이 복구되었는지 확인합니다.
+
....

[oracle@ora_01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Thu Jul 18 11:42:58 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode from v$database;

NAME      OPEN_MODE
--------- --------------------
NTAP1     READ WRITE

SQL> alter session set container=ntap1_pdb1;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
18-JUL-24 11.15.03.000000 AM
test oracle backup/restore/clone on VMware Cloud Foundation vVols


SQL>


....


====


==== 데이터베이스 복제

[%collapsible%open]
====
이 예에서 가장 최근의 백업 세트는 다른 소프트웨어 설치의 DB VM ora_02와 VCF의 ORACLE_HOME에 있는 데이터베이스를 복제하는 데 사용됩니다.

. 다시 NTAP1 백업 목록을 엽니다.  가장 최근의 데이터 백업 세트를 선택하고 클릭하십시오. `Clone` 데이터베이스 복제 워크플로를 시작하는 버튼입니다.
+
image:vcf-ora-vvol-snapctr-clone-001.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 복제 데이터베이스의 SID를 지정합니다.
+
image:vcf-ora-vvol-snapctr-clone-002.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. VCF에서 대상 데이터베이스 복제 호스트로 ora_02를 선택합니다.  호스트에 동일한 Oracle 데이터베이스 소프트웨어가 설치되고 구성되어야 합니다.
+
image:vcf-ora-vvol-snapctr-clone-003.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 대상 호스트에서 적절한 ORACLE_HOME, 사용자 및 그룹을 선택합니다.  자격 증명을 기본값으로 유지하세요.
+
image:vcf-ora-vvol-snapctr-clone-004.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 복제 데이터베이스의 구성이나 리소스 요구 사항을 충족하기 위해 복제 데이터베이스 매개변수를 변경할 수 있습니다.
+
image:vcf-ora-vvol-snapctr-clone-005.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 복구 범위를 선택하세요. `Until Cancel` 백업 세트에서 사용 가능한 마지막 로그 파일까지 복제본을 복구합니다.
+
image:vcf-ora-vvol-snapctr-clone-006.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 요약을 검토하고 복제 작업을 시작합니다.
+
image:vcf-ora-vvol-snapctr-clone-008.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 복제 작업 실행을 모니터링합니다. `Monitor` 꼬리표.
+
image:vcf-ora-vvol-snapctr-clone-009.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. 복제된 데이터베이스는 SnapCenter 에 즉시 등록됩니다.
+
image:vcf-ora-vvol-snapctr-clone-010.png["SnapCenter 구성을 보여주는 스크린샷입니다."]

. DB VM ora_02에서 복제된 데이터베이스를 검증하고 테스트 테이블을 쿼리합니다.
+
....
[oracle@ora_02 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Thu Jul 18 12:06:48 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode, log_mode from v$database;

NAME      OPEN_MODE            LOG_MODE
--------- -------------------- ------------
NTAP1CLN  READ WRITE           ARCHIVELOG

SQL> select instance_name, host_name from v$instance;

INSTANCE_NAME
----------------
HOST_NAME
----------------------------------------------------------------
NTAP1CLN
ora_02


SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP1_PDB1                     READ WRITE NO
         4 NTAP1_PDB2                     READ WRITE NO
         5 NTAP1_PDB3                     READ WRITE NO
SQL> alter session set container=ntap1_pdb1
  2  ;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
18-JUL-24 11.15.03.000000 AM
test oracle backup/restore/clone on VMware Cloud Foundation vVols


SQL>

....


이로써 VCF에서 Oracle 데이터베이스의 SnapCenter 백업, 복원 및 복제에 대한 데모가 완료되었습니다.

====


== 추가 정보를 찾을 수 있는 곳

이 문서에 설명된 정보에 대해 자세히 알아보려면 다음 문서 및/또는 웹사이트를 검토하세요.

* link:https://www.vmware.com/products/cloud-infrastructure/vmware-cloud-foundation["VMware 클라우드 파운데이션"^]
* link:https://docs.netapp.com/us-en/snapcenter/["SnapCenter software 설명서"^]

